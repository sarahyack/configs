/* THIS IS A GENERATED/BUNDLED FILE BY ESBUILD see https://github.com/BambusControl/obsidian-chronotyper for the source */
"use strict";var D=Object.defineProperty,L=Object.defineProperties,B=Object.getOwnPropertyDescriptor,W=Object.getOwnPropertyDescriptors,H=Object.getOwnPropertyNames,T=Object.getOwnPropertySymbols;var M=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var C=(a,t,e)=>t in a?D(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e,p=(a,t)=>{for(var e in t||(t={}))M.call(t,e)&&C(a,e,t[e]);if(T)for(var e of T(t))G.call(t,e)&&C(a,e,t[e]);return a},c=(a,t)=>L(a,W(t));var Y=(a,t)=>{for(var e in t)D(a,e,{get:t[e],enumerable:!0})},$=(a,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of H(t))!M.call(a,o)&&o!==e&&D(a,o,{get:()=>t[o],enumerable:!(r=B(t,o))||r.enumerable});return a};var j=a=>$(D({},"__esModule",{value:!0}),a);var i=(a,t,e)=>new Promise((r,o)=>{var s=m=>{try{l(e.next(m))}catch(d){o(d)}},n=m=>{try{l(e.throw(m))}catch(d){o(d)}},l=m=>m.done?r(m.value):Promise.resolve(m.value).then(s,n);l((e=e.apply(a,t)).next())});var Z={};Y(Z,{default:()=>x});module.exports=j(Z);var _=require("obsidian");var N=require("obsidian");var g=class extends Error{constructor(t){super(t)}};function R(a,t,e){return r=>i(null,null,function*(){if(t.filepath!=null){let o=a.vault.getFileByPath(t.filepath);if(o==null)throw new g(`File ${t.filepath} not found`);let s=p({},t);if(s.totalEditTime>0){let n=yield e.getUpdatedPropertyName(),l=yield e.getEditTimePropertyName();yield a.fileManager.processFrontMatter(o,m=>{var v;m[n]=(0,N.moment)().toISOString(!0);let d=s.totalEditTime/1e3;m[l]=Math.floor(((v=m[l])!=null?v:0)+d)})}}if(r==null)t.filepath=null,t.viewStartTime=0;else{let o=yield e.getExclusion();q(r.path,o)||(t.filepath=r.path,t.viewStartTime=Date.now())}t.lastEditTime=null,t.totalEditTime=0})}function q(a,t){return t.some(e=>(a!=null?a:"").startsWith(e))}function A(a){return(t,e)=>{a.filepath===e&&(a.filepath=t.path)}}function V(a){return t=>{a.filepath===t.path&&(a.filepath=null)}}function b(a){return()=>{var r;if(a.filepath==null)return;let t=Date.now(),e=t-((r=a.lastEditTime)!=null?r:t);e<5e3&&(a.totalEditTime+=e),a.lastEditTime=t}}var u=require("obsidian");var h=class extends u.PluginSettingTab{constructor(e,r,o){super(e,r);this.plugin=r;this.criterionStore=o;this.rendered=!1;this.containerEl.addClass("plugin","chronotyper","setting-tab")}display(){return i(this,null,function*(){if(this.rendered)return;let{containerEl:e}=this,o=(yield this.criterionStore.getExclusion())||[];yield this.displayFolderExclusions(e,o);let s=yield this.criterionStore.getUpdatedPropertyName(),n=yield this.criterionStore.getEditTimePropertyName();yield this.displayPropertySettings(e,s,n),this.rendered=!0})}displayPropertySettings(e,r,o){return i(this,null,function*(){new u.Setting(e).setHeading().setName("Property Names"),new u.Setting(e).setName("Updated timestamp property").setDesc("Property name used to store the last update timestamp in frontmatter").addText(s=>s.setValue(r).onChange(n=>i(this,null,function*(){yield this.criterionStore.overwriteUpdatedPropertyName(n)}))),new u.Setting(e).setName("Edit time property").setDesc("Property name used to store the total edit time (in seconds) in frontmatter").addText(s=>s.setValue(o).onChange(n=>i(this,null,function*(){yield this.criterionStore.overwriteEditTimePropertyName(n)})))})}displayFolderExclusions(e,r){return i(this,null,function*(){let o="";new u.Setting(e).setHeading().setName("Excluded directories").setDesc("Exclude directories from having their edit time tracked. The plugin will leave files within these directories alone."),new u.Setting(e).setName("Add a directory exclusion").addSearch(n=>{n.setPlaceholder("Enter directory path to exclude"),n.onChange((0,u.debounce)(l=>{o=l;let m=this.app.vault.getFolderByPath(l);n.inputEl.style.color=m==null?"":"green"}))}).addButton(n=>{n.setButtonText("Add").setCta().onClick(()=>i(this,null,function*(){if(o&&!r.includes(o)){let l=this.app.vault.getFolderByPath(o);if(l){let m=[...r,l.path];yield this.criterionStore.overwriteExclusion(m),this.display()}}}))});let s=e.createEl("div",{cls:"excluded-paths-list"});if(r.length===0)s.createEl("p",{text:"No directories are currently excluded."});else for(let n of r)new u.Setting(s).setName(n).addExtraButton(l=>{l.setIcon("trash").setTooltip("Remove").onClick(()=>i(this,null,function*(){let m=r.filter(d=>d!==n);yield this.criterionStore.overwriteExclusion(m),this.display()}))})})}hide(){return i(this,null,function*(){let e=(yield this.criterionStore.getExclusion())||[];yield this.criterionStore.overwriteExclusion(e)})}};var f=class{constructor(t,e,r){this.getCallback=t;this.persistCallback=e;this.value=r}get(){return i(this,null,function*(){return this.value==null&&(this.value=yield this.getCallback()),this.value})}set(t){this.value=t}persist(){return i(this,null,function*(){if(this.value==null)throw new g("Refuse to persist a null value");return yield this.persistCallback(this.value),this.value})}};var U=(a=>a)(U||{});function k(a){return Object.values(U).includes(a)}var z="0.2.0",O="0.2.0";var y=class{initData(t){return t.initialized&&J(t)?t:c(p({},t),{pluginVersion:z,initialized:!0,events:[]})}updateData(t,e){return i(this,null,function*(){return t})}};function J(a){return"events"in a&&a.events!=null&&Array.isArray(a.events)&&a.events.every(t=>k(t))}var w=class{initData(t){return t.initialized&&K(t)?t:c(p({},t),{initialized:!0,exclude:[]})}updateData(t,e){return i(this,null,function*(){return t})}};function K(a){return"exclude"in a&&Array.isArray(a.exclude)}function I(a){return a!=null&&"initialized"in a&&"version"in a}var E=class a{constructor(t,e,r){this.storedData=t;this.metaDm=e;this.criterionDm=r}initializeData(){return i(this,null,function*(){var n;let t=(n=yield this.storedData.get())!=null?n:{},e=a.shapeLoadedData(t),r=yield this.initMeta(e),o=this.initData(r);this.storedData.set(o);let s=yield this.updateData(o);this.storedData.set(s),yield this.storedData.persist()})}initMeta(t){return i(this,null,function*(){let e=this.metaDm.initData(t.meta),r=yield this.metaDm.updateData(e,new Set([]));return c(p({},t),{meta:r})})}initData(t){let e=this.criterionDm.initData(t.criterion);return c(p({},t),{criterion:e})}updateData(t){return i(this,null,function*(){let e=yield this.metaDm.updateData(t.meta,new Set([])),r=new Set(e.events),o=yield this.criterionDm.updateData(t.criterion,r);return e.events=Array.from(r),{meta:e,criterion:o}})}static shapeLoadedData(t){return{meta:a.createFragment(t.meta),criterion:a.createFragment(t.criterion)}}static createFragment(t){return I(t)?t:{initialized:!1,version:O}}};var P=class{constructor(t){this.storedData=t}getMeta(){return i(this,null,function*(){return(yield this.storedData.get()).meta})}overwriteMeta(t){return i(this,null,function*(){return(yield this.mergeData({meta:t})).meta})}getCriterion(){return i(this,null,function*(){return(yield this.storedData.get()).criterion})}overwriteCriterion(t){return i(this,null,function*(){return(yield this.mergeData({criterion:t})).criterion})}mergeData(t){return i(this,null,function*(){let e=yield this.storedData.get(),r=p(p({},e),t);return this.storedData.set(r),yield this.storedData.persist()})}};var S=class{constructor(t){this.store=t}request(t){return i(this,null,function*(){let e=yield this.store.getMeta();e.events.push(t),yield this.store.overwriteMeta(e)})}};var Q="updated",X="edited_seconds",F=class{constructor(t){this.store=t}getExclusion(){return i(this,null,function*(){let t=yield this.store.getCriterion();return t.exclude===null?[]:typeof t.exclude=="string"?t.exclude?[t.exclude]:[]:t.exclude||[]})}overwriteExclusion(t){return i(this,null,function*(){let e=yield this.store.getCriterion(),r=yield this.store.overwriteCriterion(c(p({},e),{exclude:t||[]}))})}getUpdatedPropertyName(){return i(this,null,function*(){return(yield this.store.getCriterion()).updatedPropertyName||Q})}getEditTimePropertyName(){return i(this,null,function*(){return(yield this.store.getCriterion()).editTimePropertyName||X})}overwriteUpdatedPropertyName(t){return i(this,null,function*(){let e=yield this.store.getCriterion();yield this.store.overwriteCriterion(c(p({},e),{updatedPropertyName:t}))})}overwriteEditTimePropertyName(t){return i(this,null,function*(){let e=yield this.store.getCriterion();yield this.store.overwriteCriterion(c(p({},e),{editTimePropertyName:t}))})}};var x=class extends _.Plugin{constructor(e,r){super(e,r);this.editSession={filepath:null,viewStartTime:0,lastEditTime:null,totalEditTime:0};this.eventRegistrar=new Map}onload(){return i(this,null,function*(){let e=new f(()=>this.loadData(),d=>this.saveData(d)),r=new P(e),o=new S(r),s=new F(r),n=new y,l=new w;yield new E(e,n,l).initializeData(),this.eventRegistrar.set({target:this.app.workspace,name:"file-open"},R(this.app,this.editSession,s)),this.eventRegistrar.set({target:this.app.workspace,name:"editor-change"},b(this.editSession)),this.eventRegistrar.set({target:this.app.vault,name:"delete"},V(this.editSession)),this.eventRegistrar.set({target:this.app.vault,name:"rename"},A(this.editSession)),this.addSettingTab(new h(this.app,this,s));for(let[d,v]of this.eventRegistrar)d.target.on(d.name,v)})}unload(){for(let[e,r]of this.eventRegistrar)e.target.off(e.name,r)}};

/* nosourcemap */