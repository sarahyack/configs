/* THIS IS A GENERATED/BUNDLED FILE BY ESBUILD see https://github.com/BambusControl/obsidian-chronotyper for the source */
"use strict";var h=Object.defineProperty,W=Object.defineProperties,H=Object.getOwnPropertyDescriptor,G=Object.getOwnPropertyDescriptors,Y=Object.getOwnPropertyNames,C=Object.getOwnPropertySymbols;var b=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable;var M=(a,t,e)=>t in a?h(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e,m=(a,t)=>{for(var e in t||(t={}))b.call(t,e)&&M(a,e,t[e]);if(C)for(var e of C(t))$.call(t,e)&&M(a,e,t[e]);return a},c=(a,t)=>W(a,G(t));var j=(a,t)=>{for(var e in t)h(a,e,{get:t[e],enumerable:!0})},q=(a,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Y(t))!b.call(a,o)&&o!==e&&h(a,o,{get:()=>t[o],enumerable:!(i=H(t,o))||i.enumerable});return a};var J=a=>q(h({},"__esModule",{value:!0}),a);var r=(a,t,e)=>new Promise((i,o)=>{var d=n=>{try{s(e.next(n))}catch(p){o(p)}},l=n=>{try{s(e.throw(n))}catch(p){o(p)}},s=n=>n.done?i(n.value):Promise.resolve(n.value).then(d,l);s((e=e.apply(a,t)).next())});var et={};j(et,{default:()=>T});module.exports=J(et);var L=require("obsidian");var N=require("obsidian");var g=class extends Error{constructor(t){super(t)}};function R(a,t,e){return i=>r(null,null,function*(){if(t.filepath!=null){let o=a.vault.getFileByPath(t.filepath);if(o==null)throw new g(`File ${t.filepath} not found`);let d=m({},t);if(d.totalEditTime>0){let l=yield e.getUpdatedPropertyName(),s=yield e.getEditTimePropertyName(),n=yield e.getUpdatedPropertyEnabled(),p=yield e.getEditTimePropertyEnabled();(n||p)&&(yield a.fileManager.processFrontMatter(o,v=>{var x;if(n&&(v[l]=(0,N.moment)().toISOString(!0)),p){let B=d.totalEditTime/1e3;v[s]=Math.floor(((x=v[s])!=null?x:0)+B)}}))}}if(i==null)t.filepath=null,t.viewStartTime=0;else{let o=yield e.getExclusion();K(i.path,o)||(t.filepath=i.path,t.viewStartTime=Date.now())}t.lastEditTime=null,t.totalEditTime=0})}function K(a,t){return t.some(e=>(a!=null?a:"").startsWith(e))}function V(a){return(t,e)=>{a.filepath===e&&(a.filepath=t.path)}}function A(a){return t=>{a.filepath===t.path&&(a.filepath=null)}}function U(a){return()=>{var i;if(a.filepath==null)return;let t=Date.now(),e=t-((i=a.lastEditTime)!=null?i:t);e<5e3&&(a.totalEditTime+=e),a.lastEditTime=t}}var u=require("obsidian");var D=class extends u.PluginSettingTab{constructor(e,i,o){super(e,i);this.plugin=i;this.criterionStore=o;this.rendered=!1;this.containerEl.addClass("plugin","chronotyper","setting-tab")}display(){return r(this,null,function*(){if(this.rendered)return;let{containerEl:e}=this,o=(yield this.criterionStore.getExclusion())||[];yield this.displayFolderExclusions(e,o);let d=yield this.criterionStore.getUpdatedPropertyName(),l=yield this.criterionStore.getEditTimePropertyName(),s=yield this.criterionStore.getUpdatedPropertyEnabled(),n=yield this.criterionStore.getEditTimePropertyEnabled();yield this.displayPropertySettings(e,d,l,s,n),this.rendered=!0})}displayPropertySettings(e,i,o,d,l){return r(this,null,function*(){new u.Setting(e).setHeading().setName("Property Names"),new u.Setting(e).setName("Updated timestamp property").setDesc("Property name used to store the last update timestamp in frontmatter").addText(s=>s.setValue(i).setDisabled(!d).onChange(n=>r(this,null,function*(){yield this.criterionStore.overwriteUpdatedPropertyName(n)}))).addToggle(s=>s.setValue(d).onChange(n=>r(this,null,function*(){yield this.criterionStore.overwriteUpdatedPropertyEnabled(n)}))),new u.Setting(e).setName("Edit time property").setDesc("Property name used to store the total edit time (in seconds) in frontmatter").addText(s=>s.setValue(o).setDisabled(!l).onChange(n=>r(this,null,function*(){yield this.criterionStore.overwriteEditTimePropertyName(n)}))).addToggle(s=>s.setValue(l).onChange(n=>r(this,null,function*(){yield this.criterionStore.overwriteEditTimePropertyEnabled(n)})))})}displayFolderExclusions(e,i){return r(this,null,function*(){let o="";new u.Setting(e).setHeading().setName("Excluded directories").setDesc("Exclude directories from having their edit time tracked. The plugin will leave files within these directories alone."),new u.Setting(e).setName("Add a directory exclusion").addSearch(l=>{l.setPlaceholder("Enter directory path to exclude"),l.onChange((0,u.debounce)(s=>{o=s;let n=this.app.vault.getFolderByPath(s);l.inputEl.style.color=n==null?"":"green"}))}).addButton(l=>{l.setButtonText("Add").setCta().onClick(()=>r(this,null,function*(){if(o&&!i.includes(o)){let s=this.app.vault.getFolderByPath(o);if(s){let n=[...i,s.path];yield this.criterionStore.overwriteExclusion(n),this.display()}}}))});let d=e.createEl("div",{cls:"excluded-paths-list"});if(i.length===0)d.createEl("p",{text:"No directories are currently excluded."});else for(let l of i)new u.Setting(d).setName(l).addExtraButton(s=>{s.setIcon("trash").setTooltip("Remove").onClick(()=>r(this,null,function*(){let n=i.filter(p=>p!==l);yield this.criterionStore.overwriteExclusion(n),this.display()}))})})}hide(){return r(this,null,function*(){let e=(yield this.criterionStore.getExclusion())||[];yield this.criterionStore.overwriteExclusion(e)})}};var y=class{constructor(t,e,i){this.getCallback=t;this.persistCallback=e;this.value=i}get(){return r(this,null,function*(){return this.value==null&&(this.value=yield this.getCallback()),this.value})}set(t){this.value=t}persist(){return r(this,null,function*(){if(this.value==null)throw new g("Refuse to persist a null value");return yield this.persistCallback(this.value),this.value})}};var k=(a=>a)(k||{});function z(a){return Object.values(k).includes(a)}var O="2.1.0",I="2.1.0";var f=class{initData(t){return t.initialized&&Q(t)?t:c(m({},t),{pluginVersion:O,initialized:!0,events:[]})}updateData(t,e){return r(this,null,function*(){return t})}};function Q(a){return"events"in a&&a.events!=null&&Array.isArray(a.events)&&a.events.every(t=>z(t))}var w=class{initData(t){return t.initialized&&X(t)?t:c(m({},t),{initialized:!0,exclude:[]})}updateData(t,e){return r(this,null,function*(){return t})}};function X(a){return"exclude"in a&&Array.isArray(a.exclude)}function _(a){return a!=null&&"initialized"in a&&"version"in a}var E=class a{constructor(t,e,i){this.storedData=t;this.metaDm=e;this.criterionDm=i}initializeData(){return r(this,null,function*(){var l;let t=(l=yield this.storedData.get())!=null?l:{},e=a.shapeLoadedData(t),i=yield this.initMeta(e),o=this.initData(i);this.storedData.set(o);let d=yield this.updateData(o);this.storedData.set(d),yield this.storedData.persist()})}initMeta(t){return r(this,null,function*(){let e=this.metaDm.initData(t.meta),i=yield this.metaDm.updateData(e,new Set([]));return c(m({},t),{meta:i})})}initData(t){let e=this.criterionDm.initData(t.criterion);return c(m({},t),{criterion:e})}updateData(t){return r(this,null,function*(){let e=yield this.metaDm.updateData(t.meta,new Set([])),i=new Set(e.events),o=yield this.criterionDm.updateData(t.criterion,i);return e.events=Array.from(i),{meta:e,criterion:o}})}static shapeLoadedData(t){return{meta:a.createFragment(t.meta),criterion:a.createFragment(t.criterion)}}static createFragment(t){return _(t)?t:{initialized:!1,version:I}}};var P=class{constructor(t){this.storedData=t}getMeta(){return r(this,null,function*(){return(yield this.storedData.get()).meta})}overwriteMeta(t){return r(this,null,function*(){return(yield this.mergeData({meta:t})).meta})}getCriterion(){return r(this,null,function*(){return(yield this.storedData.get()).criterion})}overwriteCriterion(t){return r(this,null,function*(){return(yield this.mergeData({criterion:t})).criterion})}mergeData(t){return r(this,null,function*(){let e=yield this.storedData.get(),i=m(m({},e),t);return this.storedData.set(i),yield this.storedData.persist()})}};var S=class{constructor(t){this.store=t}request(t){return r(this,null,function*(){let e=yield this.store.getMeta();e.events.push(t),yield this.store.overwriteMeta(e)})}};var Z="updated",tt="edited_seconds",F=class{constructor(t){this.store=t}getExclusion(){return r(this,null,function*(){let t=yield this.store.getCriterion();return t.exclude===null?[]:typeof t.exclude=="string"?t.exclude?[t.exclude]:[]:t.exclude||[]})}overwriteExclusion(t){return r(this,null,function*(){let e=yield this.store.getCriterion(),i=yield this.store.overwriteCriterion(c(m({},e),{exclude:t||[]}))})}getUpdatedPropertyName(){return r(this,null,function*(){return(yield this.store.getCriterion()).updatedPropertyName||Z})}getEditTimePropertyName(){return r(this,null,function*(){return(yield this.store.getCriterion()).editTimePropertyName||tt})}overwriteUpdatedPropertyName(t){return r(this,null,function*(){let e=yield this.store.getCriterion();yield this.store.overwriteCriterion(c(m({},e),{updatedPropertyName:t}))})}overwriteEditTimePropertyName(t){return r(this,null,function*(){let e=yield this.store.getCriterion();yield this.store.overwriteCriterion(c(m({},e),{editTimePropertyName:t}))})}getUpdatedPropertyEnabled(){return r(this,null,function*(){var e;return(e=(yield this.store.getCriterion()).updatedPropertyEnabled)!=null?e:!0})}getEditTimePropertyEnabled(){return r(this,null,function*(){var e;return(e=(yield this.store.getCriterion()).editTimePropertyEnabled)!=null?e:!0})}overwriteUpdatedPropertyEnabled(t){return r(this,null,function*(){let e=yield this.store.getCriterion();yield this.store.overwriteCriterion(c(m({},e),{updatedPropertyEnabled:t}))})}overwriteEditTimePropertyEnabled(t){return r(this,null,function*(){let e=yield this.store.getCriterion();yield this.store.overwriteCriterion(c(m({},e),{editTimePropertyEnabled:t}))})}};var T=class extends L.Plugin{constructor(e,i){super(e,i);this.editSession={filepath:null,viewStartTime:0,lastEditTime:null,totalEditTime:0};this.eventRegistrar=new Map}onload(){return r(this,null,function*(){let e=new y(()=>this.loadData(),p=>this.saveData(p)),i=new P(e),o=new S(i),d=new F(i),l=new f,s=new w;yield new E(e,l,s).initializeData(),this.eventRegistrar.set({target:this.app.workspace,name:"file-open"},R(this.app,this.editSession,d)),this.eventRegistrar.set({target:this.app.workspace,name:"editor-change"},U(this.editSession)),this.eventRegistrar.set({target:this.app.vault,name:"delete"},A(this.editSession)),this.eventRegistrar.set({target:this.app.vault,name:"rename"},V(this.editSession)),this.addSettingTab(new D(this.app,this,d));for(let[p,v]of this.eventRegistrar)p.target.on(p.name,v)})}unload(){for(let[e,i]of this.eventRegistrar)e.target.off(e.name,i)}};

/* nosourcemap */