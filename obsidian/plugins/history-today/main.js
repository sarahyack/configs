/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var w=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var S=Object.getOwnPropertyNames;var E=Object.prototype.hasOwnProperty;var N=(r,a)=>{for(var t in a)w(r,t,{get:a[t],enumerable:!0})},b=(r,a,t,s)=>{if(a&&typeof a=="object"||typeof a=="function")for(let e of S(a))!E.call(r,e)&&e!==t&&w(r,e,{get:()=>a[e],enumerable:!(s=v(a,e))||s.enumerable});return r};var k=r=>b(w({},"__esModule",{value:!0}),r);var M={};N(M,{default:()=>y});module.exports=k(M);var o=require("obsidian");var m=require("obsidian"),u=class extends m.AbstractInputSuggest{constructor(t,s){super(t,s);this.inputEl=s}getSuggestions(t){let s=[],e=t.toLowerCase(),n=c=>{c.path.toLowerCase().contains(e)&&s.push(c);for(let i of c.children)i instanceof m.TFolder&&n(i)},l=this.app.vault.getRoot();return n(l),s}renderSuggestion(t,s){s.setText(t.path)}selectSuggestion(t){this.inputEl.value=t.path,this.inputEl.trigger("input"),this.close()}};var D=require("obsidian");var T={en:{"ribbon.tooltip":"On this day","command.name":"Show Notes from This Day in History","modal.title":"Notes from This Day in History","notice.no_notes":"No historical notes found for today","note.created_at":"Created at: ","settings.title":"Settings","settings.language.name":"Language","settings.language.desc":"Choose display language","settings.searchFolder.name":"Search folder","settings.searchFolder.desc":"Choose the folder to search (root directory by default)","settings.searchFolder.placeholder":"/","settings.language.auto":"Auto","notice.daily_reminder":"Today is a historical day, do you want to see the notes?"},"zh-CN":{"ribbon.tooltip":"\u5386\u53F2\u4E0A\u7684\u4ECA\u5929","command.name":"\u663E\u793A\u5386\u53F2\u4E0A\u7684\u4ECA\u5929\u7684\u7B14\u8BB0","modal.title":"\u5386\u53F2\u4E0A\u7684\u4ECA\u5929","notice.no_notes":"\u6CA1\u6709\u627E\u5230\u5386\u53F2\u4E0A\u4ECA\u5929\u7684\u7B14\u8BB0","note.created_at":"\u521B\u5EFA\u4E8E: ","settings.title":"\u8BBE\u7F6E","settings.language.name":"\u8BED\u8A00","settings.language.desc":"\u9009\u62E9\u663E\u793A\u8BED\u8A00","settings.searchFolder.name":"\u641C\u7D22\u6587\u4EF6\u5939","settings.searchFolder.desc":"\u9009\u62E9\u8981\u641C\u7D22\u7684\u6587\u4EF6\u5939\uFF08\u9ED8\u8BA4\u4E3A\u6839\u76EE\u5F55\uFF09","settings.searchFolder.placeholder":"/","settings.language.auto":"\u81EA\u52A8","notice.daily_reminder":"\u4ECA\u5929\u662F\u4E2A\u7279\u522B\u7684\u65E5\u5B50\uFF0C\u8981\u67E5\u770B\u5386\u53F2\u4E0A\u7684\u4ECA\u5929\u7684\u7B14\u8BB0\u5417\uFF1F"}};var f=class{constructor(){this.locale="en";let a=D.moment.locale();this.setLocale(a)}setLocale(a){a.startsWith("zh")?this.locale="zh-CN":this.locale="en"}t(a){return T[this.locale][a]||T.en[a]}};var Y={language:"auto",folderPath:"/",lastCheckDate:""},y=class extends o.Plugin{async onload(){this.translator=new f,await this.loadSettings(),this.addRibbonIcon("gem",this.translator.t("ribbon.tooltip"),()=>{this.showHistoricalNotes()}),this.addCommand({id:"show-historical-notes",name:this.translator.t("command.name"),callback:()=>{this.showHistoricalNotes()}}),this.addSettingTab(new C(this.app,this)),this.app.workspace.onLayoutReady(()=>{this.checkDailyNotes()})}async checkDailyNotes(){let t=(0,o.moment)().format("YYYY-MM-DD");if(this.settings.lastCheckDate!==t){let s=(0,o.moment)().month()+1,e=(0,o.moment)().date();if(this.findHistoricalNotes(s,e).length){let l=new o.Notice(this.translator.t("notice.daily_reminder"),1e4);l.noticeEl.addEventListener("click",()=>{this.showHistoricalNotes(),l.hide()})}this.settings.lastCheckDate=t,await this.saveSettings()}}async showHistoricalNotes(){let t=(0,o.moment)(),s=t.month()+1,e=t.date(),n=this.findHistoricalNotes(s,e);n.length>0?new F(this.app,n,this.translator).open():new o.Notice(this.translator.t("notice.no_notes"))}findHistoricalNotes(t,s){let e=(0,o.moment)();return this.app.vault.getFiles().filter(l=>{if(!(this.settings.folderPath==="/"||l.path.startsWith(this.settings.folderPath))||l.extension!=="md")return!1;let i=this.app.metadataCache.getFileCache(l),d=i==null?void 0:i.frontmatter,p=d==null?void 0:d["date created"],h;if(p?h=(0,o.moment)(p):h=(0,o.moment)(l.stat.ctime),h.format("YYYY-MM-DD")===e.format("YYYY-MM-DD"))return!1;let g=h.month()+1,L=h.date();return g===t&&L===s}).sort((l,c)=>{let i=d=>{var g;let p=(g=this.app.metadataCache.getFileCache(d))==null?void 0:g.frontmatter,h=p==null?void 0:p["date created"];return h?(0,o.moment)(h).valueOf():d.stat.ctime};return i(c)-i(l)})}async loadSettings(){this.settings=Object.assign({},Y,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}},F=class extends o.Modal{constructor(t,s,e){super(t);this.notes=s;this.translator=e}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:this.translator.t("modal.title")});let s=t.createDiv("historical-notes-container");for(let e of this.notes){let n=s.createDiv("historical-note");n.createEl("h3").createEl("a",{text:e.basename,href:"#"}).addEventListener("click",async h=>{h.preventDefault(),this.openFile(e.basename),this.close()});let c=this.app.metadataCache.getFileCache(e),i=c==null?void 0:c.frontmatter,d=i==null?void 0:i["date created"],p=d?(0,o.moment)(d):(0,o.moment)(e.stat.ctime);n.createEl("p",{text:`${this.translator.t("note.created_at")}${p.format("YYYY-MM-DD")}`})}}onClose(){let{contentEl:t}=this;t.empty()}openFile(t){let s=!1;this.app.workspace.iterateAllLeaves(e=>{let n=e.view instanceof o.MarkdownView?e.view.file:null;if((n==null?void 0:n.path)===t){this.app.workspace.revealLeaf(e),e.view instanceof o.MarkdownView&&e.view.editor.focus(),s=!0;return}}),s||this.app.workspace.openLinkText(t,"",!0)}},C=class extends o.PluginSettingTab{constructor(t,s){super(t,s);this.plugin=s}display(){let{containerEl:t}=this,s=e=>this.plugin.translator.t(e);t.empty(),new o.Setting(t).setName(s("settings.searchFolder.name")).setDesc(s("settings.searchFolder.desc")).addText(e=>{e.setPlaceholder(s("settings.searchFolder.placeholder")),e.setValue(this.plugin.settings.folderPath),new u(this.app,e.inputEl),e.onChange(async n=>{this.plugin.settings.folderPath=n.endsWith("/")?n:n+"/",await this.plugin.saveSettings()})})}};

/* nosourcemap */